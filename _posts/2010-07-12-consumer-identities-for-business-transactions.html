--- 
layout: post
title: Consumer Identities for Business transactions
published: true
meta: {}

tags: 
- ADFS
- Claim-Based Identity
- Emerging Technology
- Identity
- OAuth
- OpenID
- PHP
- Windows Identity Foundation
type: post
status: publish
---
<p>A year ago I <a href="http://blogs.southworks.net/mwoloski/2009/07/14/openid-ws-fed-protocol-transition-sts/">wrote a blog post</a> about how to use the Windows Identity Foundation with OpenID. Essentially the idea was writing an STS that can speak both protocol WS-Federation and OpenID, so your apps can keep using WIF as the claims framework, no matter what your Identity Provider is. WS-Fed == enterprise, OpenID == consumer…</p>  <p>Fast forward to May this year, I’m happy to disclose the proof of concept we did with the Microsoft Federated Identity Interop group (represented by <a href="http://self-issued.info">Mike Jones</a>), <a href="http://www.medtronic.com">Medtronic</a> and <a href="https://www.paypal-ids.com/">PayPal</a>. The official <a href="http://blogs.msdn.com/b/interoperability/archive/2010/07/09/identity-mash-up-federation-demo-using-multiple-protocols-openid-and-ws-federation.aspx">post from the Interoperability blog</a> includes a <a href="http://channel9.msdn.com/posts/jccim/Identity-Mash-up-Federation-Demo-using-Multiple-Protocols-OpenID-and-WS-Federation/">video about it</a> and Mike also did a <a href="http://self-issued.info/?p=325">great write up</a>. I like how <a href="http://www.identityblog.com/?p=1146">Kim Cameron</a> summarized the challenges and lessons learnt of this PoC:</p>  <blockquote>   <p><em>The change agent is the power of claims.&#160; The mashup Mike describes crosses boundaries in many dimensions at once:</em> </p>    <ul>     <li><em>between industries (medical, financial, technical) </em></li>      <li><em>between organizations (Medtronic, PayPal, Southworks, Microsoft) </em></li>      <li><em>between protocols (OpenID and SAML) </em></li>      <li><em>between computing platforms (Windows and Linux) </em></li>      <li><em>between software products (Windows Identity Foundation, DotNetOpenAuth, SimpleSAMLphp) </em></li>      <li><em>between identity requirements (ranging from strong identity verification to anonymous comment)</em> </li>   </ul> </blockquote>  <p>The business scenario brought by Medtronic is around an insulin pump trial. In order to register to this trial, users would login with PayPal, which represents a trusted authority for authentication and attributes like shipping address and age for them. Below are some screenshots of the actual proof of concept:</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2010/07/image.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2010/07/image-thumb.png" width="507" height="285" /></a> </p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2010/07/image1.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2010/07/image-thumb1.png" width="507" height="309" /></a> </p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2010/07/image2.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2010/07/image-thumb2.png" width="511" height="363" /></a> </p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2010/07/image3.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2010/07/image-thumb3.png" width="506" height="360" /></a> </p>  <p>While there are different ways to solve a scenario like this, we chose to create an intermediary Security Token Service that understands the OpenID protocol (used by PayPal), WS-Federation protocol and SAML 1.1 tokens (used by Medtronic apps). This intermediary STS enables SSO between the web applications, avoiding re-authentication with the original identity provider (PayPal). </p>  <p>Also, we had to integrate with a PHP web application and we chose the <a href="http://rnd.feide.no/simplesamlphp">simpleSAMLphp</a> library. We had to adjust here and there to make it compatible with ADFS/WIF implementation of the standards. No big changes though.</p>  <p>We decided together with the Microsoft Federated Identity Interop team to make the implementation of this STS available under open source using the <a href="http://opensource.org/licenses/ms-pl.html">Microsoft Public License</a>.</p>  <p>And not only that but also we went a step further and added a multi-protocol capability to this claims provider. This is, it’s extensible to support not only OpenID but also OAuth and even a proprietary authentication method like Windows Live.</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2010/07/image4.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2010/07/image-thumb4.png" width="508" height="227" /></a></p>          <p><em><strong>DISCLAIMER</strong>: <em>This code is provided as-is under the </em><a href="http://www.opensource.org/licenses/ms-pl.html"><em>Ms-PL license</em></a><em>. It has not been tested in production environments and it has not gone through threats and countermeasures analysis. Use it at your own risk.</em></em><em></em></p>  <p><strong>Project Home page      <br /></strong><a href="http://github.com/southworks/protocol-bridge-claims-provider">http://github.com/southworks/protocol-bridge-claims-provider</a></p>  <p><strong>Download      <br /></strong><a href="http://github.com/southworks/protocol-bridge-claims-provider/downloads">http://github.com/southworks/protocol-bridge-claims-provider/downloads</a></p>  <p><strong>Docs      <br /></strong><a href="http://southworks.github.com/protocol-bridge-claims-provider">http://southworks.github.com/protocol-bridge-claims-provider</a></p>  <p>If you are interested and would like to contribute, ping us through the github page, twitter @woloski or email matias at southworks dot net</p>  <p>This endeavor could not have been possible without the professionalism of my colleagues: <a href="http://blogs.southworks.net/jpgarcia">Juan Pablo Garcia</a> who was the main developer behind this project, <a href="http://blogs.southworks.net/tosborn">Tim Osborn</a> for his support and focus on the customer, <a href="http://blogs.southworks.net/jhalife">Johnny Halife</a> who helped shaping out the demo in the early stages in HTML :), and <a href="http://blogs.southworks.net/siacomuzzi">Sebastian Iacomuzzi</a> that helped us with the packaging. Finally, Madhu Lakshmikanthan who was key in the project management to align stakeholders and Mike who was crucial in making all this happen.</p>  <p>Happy federation!</p>
