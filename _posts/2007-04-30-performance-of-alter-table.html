--- 
layout: post
title: Performance of ALTER TABLE
published: true
meta: {}

tags: 
- Architecture
- SaaS
type: post
status: publish
---
<p>Reading <a href="http://diegumzone.spaces.live.com/blog/cns!1AD5096D63670065!801.entry">a post</a> from <a href="http://diegumzone.spaces.live.com/blog/">Diego Dagum's blog</a> I remembered about an interesting topic related to SaaS. In his article, Diego, talks about an experience he has with a customer that developed an application for multiple customers (multi-tenant). They had a performance issue because they were using shared-schema (i.e. extended fields stored in a separate table as rows pointing to the shared data table).</p> <p><img src="http://msdn2.microsoft.com/en-us/library/Aa479086.mlttntda04(en-us,MSDN.10).gif"> </p> <p><em>Figure 1 - Shared schema approach (<a href="http://msdn2.microsoft.com/en-us/library/aa479086.aspx">Multi Tenant Data Architecture paper</a>)</em></p> <p>Diego and his colleague tried to convince the customer to move to the separate schema approach. In this approach each customer has its own table and every time he wants to customize an ALTER TABLE is used)</p> <p>The customer immediately refused the ALTER TABLE because of the myth that altering the schema of a table is a *HEAVY *operation. </p> <p>It seems the story ends with the customer afraid to go with that approach, but this is a very interesting issue for multi-tenant applications. Modern databases implement ALTER TABLE very fast depending on the structure of the table and the change that wants to be done.</p> <p>Let's enumerate the common scenarios and how SQL Server manage this:</p> <ul> <li><strong>Adding a column</strong>: when you add a *NULLable* column to a table only metadata changes (syscolumns).</li> <li><strong>Dropping a column</strong>: the same applies when you drop a column</li> <li><strong>Changing a data type</strong>: this is tricky. Changing the data type to something larger should only be metadata change and the physical change in the rows should not happen until the rows are updated. When changing the data type to something smaller, SQL Server will have to validate to make sure current data fits in the smaller type</li></ul> <p>There is an interesting (paid) article that explore the insides of ALTER TABLE: <a title="http://www.sqlmag.com/Article/ArticleID/40538/sql_server_40538.html" href="http://www.sqlmag.com/Article/ArticleID/40538/sql_server_40538.html">http://www.sqlmag.com/Article/ArticleID/40538/sql_server_40538.html</a></p> <p>PS: Talking about Diego, if you read Spanish make sure to read his architecture bulletins. There are already 3 of them:</p> <p><a href="http://diegumzone.spaces.live.com/blog/cns!1AD5096D63670065!765.entry">Abril 19, Boletin Oficial de Arquitectura #3</a></p> <p><a href="http://diegumzone.spaces.live.com/blog/cns!1AD5096D63670065!714.entry">Abril 05, Boletin Oficial de Arquitectura #2</a></p> <p><a href="http://diegumzone.spaces.live.com/blog/cns!1AD5096D63670065!685.entry">Marzo 18, Boletin Oficial de Arquitecture #1</a></p>
