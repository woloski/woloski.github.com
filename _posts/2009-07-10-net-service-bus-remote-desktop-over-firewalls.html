--- 
layout: post
title: ".NET Service Bus \xE2\x80\x93 Remote Desktop over Firewalls!"
published: true
meta: {}

tags: 
- Azure
- CoolStuff
- NET Services
- Service Bus
type: post
status: publish
---
<p>Today was holiday in Argentina but I had to work on some pending stuff (yeah, lucky me). I didn’t want to travel to the office but I had to access a SQL Server that was hosted at <a href="http://www.southworks.net">Southworks</a> LAN and we don’t have inbound ports open to connect to our workstations through RDP (port 3389). So…. the <a href="http://www.microsoft.com/azure/servicebus.mspx">.Net Service Bus</a> came to the rescue! Last week <a href="http://davidaiken.com/">David Aiken</a> told me about this cool project hosted on codeplex <a href="http://socketshifter.codeplex.com">http://socketshifter.codeplex.com</a>. He told me “these people are streaming video over the service bus”...</p>  <p>So yesterday before leaving the office I opened up the <a href="http://socketshifter.codeplex.com/">socketshifter</a> server, configured my service bus account and allowed some ports to be redirected. Today I connected from home and here is a nice screenshot of RDP to a Southworks LAN machine (connected to localhost:1000). Isn’t it cool??!!?!</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2009/07/image.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2009/07/image-thumb.png" width="804" height="604" /></a> </p>  <p>For those of you who are wondering how these work, the code is reeeeallly simple because all of the hardlifting is made by the service bus. There is a client and a server that will redirect a stream of bytes from port a to port b (using plain sockets). The socket shifter client will establish a session to the server via the service bus using the <strong>NetTcpRelayBinding</strong>. The rest of the story is bytes flowing around :)</p>  <p></p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2009/07/image1.png"><img border="0" alt="image" src="http://blogs.southworks.net/mwoloski/files/2009/07/image-thumb1.png" width="640" height="383" /></a> </p>  <p>This is the client running on my laptop:</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2009/07/clip-image002.jpg"><img border="0" alt="clip_image002" src="http://blogs.southworks.net/mwoloski/files/2009/07/clip-image002-thumb.jpg" width="681" height="346" /></a></p>  <p>And this is the configuration on the client</p>  <p><font face="consolas">&lt;configuration&gt;     <br />&#160; &lt;appSettings&gt;      <br />&#160;&#160;&#160; &lt;add key=&quot;solutionName&quot; value=&quot;southworks-magnolia&quot;/&gt;      <br />&#160;&#160;&#160; &lt;add key=&quot;password&quot; value=&quot;....&quot;/&gt;&#160;&#160;&#160; <br />&#160;&#160;&#160; &lt;add key=&quot;servicePath&quot; value=&quot;sb://southworks-magnolia.servicebus.windows.net/rd&quot;/&gt;      <br />&#160;&#160;&#160; &lt;add key=&quot;localPort&quot; value=&quot;1000&quot; /&gt;      <br />&#160;&#160;&#160; &lt;add key=&quot;remoteHost&quot; value=&quot;localhost&quot;/&gt;      <br />&#160;&#160;&#160; &lt;add key=&quot;remotePort&quot; value=&quot;3389&quot;/&gt;      <br />&#160; &lt;/appSettings&gt;      <br />&lt;/configuration&gt;</font></p>  <p>The server needs to be installed as a Windows Service to be able to redirect 3389. I also tried accessing the web server (IIS7) that is running on the LAN and it worked (need to configure the remoteport to 80). So that means that I can expose a web server that runs on my desktop machine and show stuff to customers without asking IT to move my machine to the DMZ!! <a href="http://blogs.msdn.com/clemensv/archive/2009/04/05/net-services-march-2009-ctp-host-a-public-website-at-the-kitchen-table-or-from-a-coffee-shop-no-kidding.aspx">Clemens did something similar</a> couple of months ago.</p>  <p>This is a very cool use of the Service Bus. Go ahead and try it yourself! Download the <a href="http://socketshifter.codeplex.com/SourceControl/ListDownloadableCommits.aspx">latest source code</a>.</p>
