--- 
layout: post
title: Web Client Software Factory Automation
published: true
meta: {}

tags: 
- CAB
- Web Client Software Factory
type: post
status: publish
---
<p><a href="/photos/blog_gallery/picture1298.aspx" target="_blank"></a>(This post was going to be posted a few weeks ago so the images are a bit outdated but the content is the same that you will see in latest drops)</p>  <p>I&#8217;ve been working on the Guidance Packages for the <a href="/controlpanel/blogs/www.codeplex.com/websf">Web Client Software Factory</a>. If you read this blog you probably know what is this all about. If not, in short we are adding functionality to Visual Studio 2005 to make the developer life easier :)</p>  <p>In the case of the Web Client Software Factory (WCSF from now on), in this first release we are targeting modularity, security and a testable programming model among other things.</p>  <p>In this drop you will see something really close to what we will be shipping.</p>  <p>Let&#8217;s deep into what the Guidance Package brings to the table.</p>  <p>First of all we will create a new web application and let&#8217;s call it &#8220;OrderManager&#8221;</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca1.jpg"><img height="378" alt="wca1" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca1-thumb.jpg" width="504" border="0" /></a> </p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca2.jpg"><img height="360" alt="wca2" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca2-thumb.jpg" width="505" border="0" /></a> </p>  <p>Before creating the actual solution the recipe asks for a few things:</p>  <ul>   <li>Where do you have the binaries (the new CompositeWeb Application Block and Enterprise Library Jan 2006)? <em>I have compiled them and put them in c:\Lib</em> </li>    <li>What&#8217;s the .net namespace that you will use for this application? </li> </ul>  <p>This is what we get after the solution is created:</p>  <p><a href="/photos/blog_gallery/picture1300.aspx" target="_blank"></a></p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca3.jpg"><img height="367" alt="wca3" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca3-thumb.jpg" width="247" border="0" /></a> </p>  <p>In a nutshell:</p>  <ul>   <li>A <strong>Website</strong> containing a default page, a default master page a default theme, references to the application blocks and EntLib. </li>    <li>A <strong>Shell</strong> module with a ModuleInitializer. This module will be used for pages that lives in the website root and some services initialization (like the <em>SiteMapBuilderService</em> and the <em>EnterpriseLibraryAuthorizationService</em>) </li> </ul>  <p>If you run the website at this point you will get this:</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca4.jpg"><img height="352" alt="wca4" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca4-thumb.jpg" width="500" border="0" /></a> </p>  <p><strong>Adding a module&#8230;</strong></p>  <p>We can add our first module by doing a right-click on the Modules solution folder.</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca5.jpg"><img height="184" alt="wca5" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca5-thumb.jpg" width="473" border="0" /></a> </p>  <p>The following feature is part of the &#8220;new generation&#8221; of guidance packages. Before you commit your module creation you can see what is going to happen to your solution (one project will be created, a folder on the website will be created, etc.)</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca6.jpg"><img height="376" alt="wca6" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca6-thumb.jpg" width="502" border="0" /></a> </p>  <p>The options are:</p>  <ul>   <li>What&#8217;s the website project where you want to plug this module? </li>    <li>Do you want to have a different name for the folder on the website? </li>    <li>Finally we have an &#8220;Add test project&#8221; option that will create a VSTS test project for you with the Test Fixture for the DefaultViewPresenter </li> </ul>  <p>If we run the solution again we will see the new module plugged in the website</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca7.jpg"><img height="356" alt="wca7" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca7-thumb.jpg" width="506" border="0" /></a> </p>  <p>The cool thing about this is the loosely coupled model to add nodes to the sitemap. The OrdersModuleInitializer has a template method to register the sitemap nodes that the module will provide. Here we register the module site map node:</p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;color: blue;font-family: &#39;Courier New&amp;#39">protected</span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"> <span style="color: blue">virtual</span> <span style="color: blue">void</span> RegisterSiteMapInformation(<span style="color: teal">ISiteMapBuilderService</span> siteMapBuilderService)</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160; </span><span>&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: teal">SiteMapNodeInfo</span> moduleNode = <span style="color: blue">new</span> <span style="color: teal">SiteMapNodeInfo</span>(<span style="color: maroon">&quot;Orders&quot;</span>, <span style="color: maroon">&quot;~/Orders/Default.aspx&quot;</span>, <span style="color: maroon">&quot;Orders&quot;</span>);</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>siteMapBuilderService.AddNode(moduleNode);<span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: green"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>}</span></p>  <p>(A nice addition to this would be a service that reads from the module web.config file and creates the corresponding nodes)</p>  <p><strong>Adding a web page&#8230;</strong></p>  <p>We can create pages for our module by right clicking on the &#8220;Orders&#8221; module folder on the website</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca8.jpg"><img height="76" alt="wca8" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca8-thumb.jpg" width="387" border="0" /></a> </p>  <p>We are leveraging the MVP (Model-View-Presenter) pattern. If you used the Smart Client Software Factory you should be familiar with this, if not you can read more about it <a href="http://msdn.microsoft.com/msdnmag/issues/06/08/DesignPatterns/default.aspx" target="_blank">here</a> and <a href="http://www.martinfowler.com/eaaDev/uiArchs.html" target="_blank">here</a>.</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca9.jpg"><img height="377" alt="wca9" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca9-thumb.jpg" width="505" border="0" /></a> </p>  <p>The view is separated in three parts:</p>  <ul>   <li>The <em>OrderListPresenter</em> holds the logic for the view and has access to the view via an interface (<em>IOrderList</em>). This increases the testability of your applications. The idea is to have the view do almost nothing. Its responsibility will be to show stuff that the presenter wants and notify the presenter of user events (clicks, selects, etc.). </li>    <li>The <em>IOrderList</em> interface is the contract for the Presenter </li>    <li>Finally the <em>OrderList.aspx</em> + .cs is the actual implementation of the interface that will show things on the webpage. </li> </ul>  <p>If we want to show this view in the navigation control (in this case a TreeView) we would add the following code to the <em>RegisterSiteMapInformation</em>:</p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;color: blue;font-family: &#39;Courier New&amp;#39">&#160;&#160;&#160;&#160;&#160;&#160;&#160; protected</span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"> <span style="color: blue">virtual</span> <span style="color: blue">void</span> RegisterSiteMapInformation(<span style="color: teal">ISiteMapBuilderService</span> siteMapBuilderService)</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: teal">SiteMapNodeInfo</span> moduleNode = <span style="color: blue">new</span> <span style="color: teal">SiteMapNodeInfo</span>(<span style="color: maroon">&quot;Orders&quot;</span>, <span style="color: maroon">&quot;~/Orders/Default.aspx&quot;</span>, <span style="color: maroon">&quot;Orders&quot;</span>);</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt 70.8pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39">siteMapBuilderService.AddNode(moduleNode);<span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: green"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>      <p></p>     <strong><span style="color: teal">SiteMapNodeInfo</span> orderListNode = <span style="color: blue">new</span> <span style="color: teal">SiteMapNodeInfo</span>(<span style="color: maroon">&quot;OrderList&quot;</span>, <span style="color: maroon">&quot;~/Orders/OrderList.aspx&quot;</span>, <span style="color: maroon">&quot;Order List&quot;</span>);</strong></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>siteMapBuilderService.AddNode(orderListNode, moduleNode);</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>}</span></p>  <p>Running the site at this instance will show the following:</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca10.jpg"><img height="354" alt="wca10" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca10-thumb.jpg" width="500" border="0" /></a> </p>  <p><strong>Implementing a view and its presenter&#8230;</strong></p>  <p>We will implement the basic things to show a list of orders on the web page.</p>  <p>Let&#8217;s start from the presenter logic. <em>Note: If we were using TDD we would start from a test that would be called &#8220;ShowOrderListOnViewLoaded()&#8221;.</em></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;color: blue;font-family: &#39;Courier New&amp;#39">&#160;&#160;&#160; public</span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"> <span style="color: blue">class</span> <span style="color: teal">OrderListPresenter</span> : <span style="color: teal">Presenter</span>&lt;<span style="color: teal">IOrderList</span>&gt;</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">void</span> OnViewLoaded()</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: green">// TODO: Implement code that will be executed every time the view loads</span></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><strong><span style="color: teal">List</span>&lt;<span style="color: teal">Order</span>&gt; orders = <span style="color: blue">new</span> <span style="color: teal">List</span>&lt;<span style="color: teal">Order</span>&gt;();</strong></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>orders.Add(<span style="color: blue">new</span> <span style="color: teal">Order</span>(<span style="color: maroon">&quot;Order 1&quot;</span>, 12300, <span style="color: teal">DateTime</span>.Now));</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>orders.Add(<span style="color: blue">new</span> <span style="color: teal">Order</span>(<span style="color: maroon">&quot;Order 2&quot;</span>, 200, <span style="color: teal">DateTime</span>.Now));</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>orders.Add(<span style="color: blue">new</span> <span style="color: teal">Order</span>(<span style="color: maroon">&quot;Order 3&quot;</span>, 100000, <span style="color: teal">DateTime</span>.Now));</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span></strong><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39">View.Orders = orders;</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>}</span></p>  <p>We are setting the <em>Orders</em> of the <em>View</em> property. The View property belongs to the base Presenter class and it provides access to the view via its interface (IOrderList).    <br />That means that we need to add the Orders property on the interface</p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;color: blue;font-family: &#39;Courier New&amp;#39">&#160;&#160;&#160; public</span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"> <span style="color: blue">interface</span> <span style="color: teal">IOrderList</span></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: teal">IList</span>&lt;<span style="color: teal">Order</span>&gt; Orders { <span style="color: blue">set</span>; }</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160; </span></span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39">}</span></p>  <p>Finally we will implement it on the <em>OrderList.aspx</em>:</p>  <p>We can use the smart tag on the interface to generate the required interface contract:</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca11.jpg"><img height="89" alt="wca11" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca11-thumb.jpg" width="508" border="0" /></a> </p>  <p>Then we add the GridView to the page</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca12.jpg"><img height="261" alt="wca12" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca12-thumb.jpg" width="272" border="0" /></a> </p>  <p>And finally implement the interface:</p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;color: blue;font-family: &#39;Courier New&amp;#39">&#160;&#160;&#160; public</span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"> <span style="color: teal">IList</span>&lt;<span style="color: teal">Order</span>&gt; Orders</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: blue">set</span></span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>GridView1.DataSource = <span style="color: blue">value</span>;</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><strong><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>GridView1.DataBind();</span></strong></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39">}</span></p>  <p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 10pt;font-family: &#39;Courier New&amp;#39"><span>&#160;&#160;&#160; </span>}</span></p>  <p>Running the site again&#8230;</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wca13.jpg"><img height="354" alt="wca13" src="http://blogs.southworks.net/mwoloski/files/2008/06/wca13-thumb.jpg" width="503" border="0" /></a> </p>  <p>That&#8217;s it. We have a Web application that leverages:</p>  <ul>   <li>MVP design pattern </li>    <li>The best practices for ASP.Net </li>    <li>Exception handling using Enterprise Library 2006 </li>    <li>Authorization infrastructure also from Enterprise Library </li>    <li>Dependency Injection </li>    <li>And a lot of other things that you will discover&#8230; </li> </ul>  <p>Lastly, if you are wondering about &#8220;<em>Why use GridView.DataSource and not some DataSourceControl like ObjectDataSource?</em>&#8221;    <br />We are shipping with the factory a DataSourceControl called ObjectContainerDataSource that will work very well in these scenarios. Mariano has an <a href="/blogs/mariano/archive/2006/12/13/New-drop-of-the-Web-Client-Software-Factory.aspx" target="_blank">interesting post</a>.</p>
