--- 
layout: post
title: WSE 3 and AzMan - Authorization on a Service-Oriented approach
published: true
meta: {}

tags: 
- Architecture
- WSE
type: post
status: publish
---
<p>One of the challenges presented when developing Service-Oriented   <br />application is how to setup the authorization for services. That means    <br />&quot;Role salesman is granted to access CreateOrder service&quot;</p>  <p>The ideal would be:</p>  <ol>   <li>to have a pipe &amp; filters pluggable architecture where you     <br />could add/remove components without affecting the code of the services      <br />(this is also called cross-cutting concerns) </li>    <li>to have a nice GUI to manage Tasks and Roles </li>    <li>to have a programmatic API to do the access check in an agnostic     <br />provider way so if we want to change the Authorization provider in the      <br />future, make it painless. </li> </ol>  <p>Luckily these days of continous innovation we have all of these to support it:</p>  <ol>   <li><a href="http://msdn.microsoft.com/webservices/building/wse/default.aspx">WSE 3</a> and it <a href="/blogs/matiaswoloski/archive/2005/10/01/WsePolicyAssertionsExecution.aspx">Policy Assertions</a> </li>    <li><a href="http://msdn.microsoft.com/msdnmag/issues/03/11/AuthorizationManager/">AzMan</a> (Authorization Manager) </li>    <li><a href="http://www.gotdotnet.com/codegallery/codegallery.aspx?id=295a464a-6072-4e25-94e2-91be63527327">Enterprise Library</a> or <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnpag2/html/paght000019.asp">RoleProvider of ASP.Net 2</a> </li> </ol>  <p>Regards <b>(1)</b> I've already written in a previous post about the Policy    <br />Assertions and its purpose. The idea would be to plug a Policy    <br />Assertion that would call AzMan through EntLib or RoleProvider. In this    <br />assertion we take the Action name of WSE using <span style="font-style: italic">envelope.Context.Addressing.Action.Value</span> and the WindowsPrincipal if we are using KerberosToken in WSE.</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wse1.jpg"><img height="269" alt="wse1" src="http://blogs.southworks.net/mwoloski/files/2008/06/wse1-thumb.jpg" width="433" border="0" /></a> </p>  <p>In <b>(2) </b>we have this great GUI (Azman.msc) to manage Tasks and Roles.</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wse2.gif"><img height="404" alt="wse2" src="http://blogs.southworks.net/mwoloski/files/2008/06/wse2-thumb.gif" width="416" border="0" /></a> </p>  <p>To install AzMan on Windows XP Professional</p>  <p>Install the Windows Server 2003 Administration Tools Pack, which you   <br />can download from    <br />http://www.microsoft.com/downloads/details.aspx?FamilyID=e487f885-f0c7-436a-a392-25793a25bad7&amp;DisplayLang=en.    <br />This tools pack enables remote server management of Windows Server    <br />2003, but it also includes AzMan.</p>  <p>Note that if you are running Windows XP Service Pack 2 or later, you   <br />must also install Service Pack 1 or later of the Windows Server 2003    <br />Administration Tools Pack.</p>  <p>To install AzMan on Windows 2000</p>  <p>Install the Windows 2000 Authorization Manager Runtime, which you can   <br />download from    <br /><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=7edde11f-bcea-4773-a292-84525f23baf7&amp;DisplayLang=en">http://www.microsoft.com/downloads/details.aspx?FamilyID=7edde11f-bcea-4773-a292-84525f23baf7&amp;DisplayLang=en</a>.    <br />You must be running Windows 2000 Server Service Pack 4 or later. You    <br />must also install MSXML 4.0 or later.</p>  <p>Note that this installs the runtime components only; it does not   <br />install the AzMan administration MMC snap-in. You can still use the MMC    <br />snap-in on a Windows Server 2003 system, or on a Windows XP system that    <br />has the Windows Server 2003 Administration Tools Pack installed, to    <br />remotely administer AzMan on a Windows 2000 Server.</p>  <p>On Windows XP and Windows 2000, you must install the primary interop   <br />assembly for the AzMan COM object into the global assembly cache. This    <br />assembly is already installed in the global assembly cache on Windows    <br />Server 2003 systems.</p>  <p>Finally regards <b>(3)</b> we could use Enterprise Library Security Application Block which implements an AuthorizationProvider based on Azman. I show in <a href="/blogs/matiaswoloski/archive/2005/04/12/8.aspx">this post</a>    <br />how to use it. Using EntLib will abstract us from the store which in    <br />this case is AzMan and this will lead to more flexibility because in    <br />the future we could use another store (SQL Server, ADAM, AD, etc).</p>  <p><a href="http://blogs.southworks.net/mwoloski/files/2008/06/wse3.jpg"><img height="367" alt="wse3" src="http://blogs.southworks.net/mwoloski/files/2008/06/wse3-thumb.jpg" width="479" border="0" /></a> </p>  <p>The thing I didn't like about AzMan was that it is bounded to Windows   <br />Tokens. But after some research I found the Custom SID story.</p>  <p><a href="http://www.leastprivilege.com/AzManAndCustomSIDsPart1.aspx">These</a> <a href="http://www.leastprivilege.com/AzManAndCustomSIDsPart2.aspx">series</a> of <a href="http://www.leastprivilege.com/AzManAndCustomSIDsPart3.aspx">posts</a> talk about how to implement it.<a href="http://www.leastprivilege.com/AzManAndCustomSIDsPart1.aspx"></a></p>  <p>Read this article for an indepth on this post: <a href="http://msdn.microsoft.com/webservices/default.aspx?pull=/msdnmag/issues/05/11/azmanandwse30/default.aspx">Combine the Powers of AzMan and WSE 3.0 to Protect Your Web Services</a> from the November 2005 of MSDN Magazine</p>
